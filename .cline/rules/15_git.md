# Gitワークフロー

このドキュメントでは、コミットとプルリクエストの作成に関するベストプラクティスを説明します。

## コミットの作成

### 1. 変更の確認

```shell
# 未追跡ファイルと変更の確認
git status

# 変更内容の詳細確認
git diff

# コミットメッセージのスタイル確認
git log
```

### 2. 変更の分析

- 変更または追加されたファイルの特定
- 変更の性質（新機能、バグ修正、リファクタリングなど）の把握
- プロジェクトへの影響評価
- 機密情報の有無確認

### 3. コミットメッセージの作成

コミットメッセージは以下の形式に従います：

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

- **type**: 変更の種類を表す
  - `feat`: 新機能
  - `fix`: バグ修正
  - `docs`: ドキュメントのみの変更
  - `style`: コードの意味に影響しない変更（空白、フォーマット、セミコロンなど）
  - `refactor`: バグ修正や機能追加を含まないコードの変更
  - `perf`: パフォーマンスを改善するコードの変更
  - `test`: テストの追加・修正
  - `build`: ビルドシステムや外部依存に関する変更
  - `ci`: CI設定ファイルやスクリプトの変更
  - `chore`: その他の変更

- **scope**: 変更の範囲を表す（任意）
  - 例: auth, api, core, ui など

- **description**: 変更の要約
  - 命令形で記述（"変更"ではなく"変更する"）
  - 日本語で記述
  - 末尾にピリオドを付けない

- **body**: 変更の詳細な説明（任意）
  - 変更の動機や前後の状況を説明
  - 複数行可

- **footer**: 注釈（任意）
  - `BREAKING CHANGE`: 後方互換性のない変更
  - `Closes #123`: Issue参照
  - `Co-authored-by`: 共同作者

### 4. AIツールとの連携

- AIが生成したコードは明示的にマーク
- 生成コードの検証結果を記録
- レビュー時の注意点を明記
- 例:

```shell
git commit -m "$(cat <<'EOF'
feat: ユーザー認証機能の実装

- 認証ロジックの基本実装
- セッション管理の追加
- エラーハンドリングの実装

🤖 Claude で生成したコードをベースに実装
- 型安全性を強化
- エラーケースを追加
- テストを拡充

レビュー時の注意点:
- 生成コードの型定義
- エラー処理の網羅性
- セキュリティ対策の妥当性
EOF
)"
```

## プルリクエストの作成

### 1. 事前確認

```shell
# 未コミットの変更確認
git status

# mainからの差分確認
git diff main...HEAD

# コミット履歴の確認
git log
```

### 2. 変更の分析

- mainから分岐後のすべてのコミットの確認
- 変更の性質と目的の把握
- プロジェクトへの影響評価
- 機密情報の有無確認

### 3. AIツールによる生成物の取り扱い

- AI生成コードを含むファイルの明示
- 検証プロセスの説明
- 手動での修正箇所の明記
- 例:

```markdown
## レビュー観点

- AI生成コードの確認:
  - TypeScript型定義の適切さ
  - エラー処理の網羅性
  - セキュリティリスクの検証
  - パフォーマンスへの影響

- 手動修正箇所:
  - 認証ロジックの強化
  - エラーメッセージの日本語化
  - テストケースの追加
```

## 重要な注意事項

### コミット関連

- 可能な場合は `git commit -am` を使用
- 関係ないファイルは含めない
- 空のコミットは作成しない
- git設定は変更しない

### プルリクエスト関連

- 必要に応じて新しいブランチを作成
- 変更を適切にコミット
- リモートへのプッシュは `-u` フラグを使用
- すべての変更を分析

### AI生成コードの取り扱い

- 生成コードは必ず人間がレビュー
- 型定義とエラー処理を重点的に確認
- セキュリティリスクを慎重に評価
- 生成過程と修正内容を文書化

### 避けるべき操作

- 対話的なgitコマンド（-iフラグ）の使用
- リモートリポジトリへの直接プッシュ
- git設定の変更
- AI生成コードの無条件な受け入れ

## コミットメッセージの例

```text
# バグ修正
fix(auth): 認証トークンの期限切れ処理を修正

# 新機能
feat(auth): ユーザー認証にResult型を導入

BREAKING CHANGE: 認証関数の戻り値がPromise<boolean>からPromise<Result>に変更

# リファクタリング
refactor(api): Adapterパターンを使用して外部依存を抽象化

# パフォーマンス改善
perf(cache): キャッシュロジックの最適化

# テスト
test(auth): ログイン失敗時のテストケース追加

# ビルドプロセス
build: TypeScriptのビルド設定を更新

# CI関連
ci: GitHub Actionsのワークフローを追加

# ドキュメント更新
docs(api): API仕様書の更新と日本語化

# 依存関係
deps: neverthrowパッケージを追加

# その他
chore(deps): パッケージを最新版に更新
```

## 参考文献

このドキュメントは以下の文献を参考に作成しました：

- [mizchi/ailab - Git Workflow](https://github.com/mizchi/ailab/blob/main/.cline/rules/_git.md)
  - 基本的なGitワークフローとベストプラクティス
  - コミットメッセージとプルリクエストの例
- [Conventional Commits 1.0.0](https://www.conventionalcommits.org/ja/v1.0.0/)
  - コミットメッセージの規約
  - 型の定義と使用例
- [Conventional Commits](https://www.conventionalcommits.org/)
  - コミットメッセージの構造化