## ワークフローパターン

### タスク開始時の分析
1. **事前調査:**
   - 類似実装やベストプラクティスの調査
   - 参考リポジトリの構成確認
   - 使用技術の最新推奨事項の確認
   - 調査結果の文書化

2. **メモリーバンク確認:**
   - 関連するメモリーバンクファイルを精査
   - コンテキストを完全に把握

3. **要求分析:**
   - ユーザーの要求を明確化
   - 既存コードとの整合性を確認
   - 技術的制約の特定

4. **アプローチ検討:**
   - 複数の実装方法を列挙
   - 参考実装との比較検討
   - 評価基準に基づき最適な方法を選択
   - 選定理由の文書化

5. **計画立案:**
   - 必要な手順を明確化
   - 使用するツールを特定（pnpm優先）
   - TypeScriptでの実装計画
   - レビュー計画の作成

### 実装と検証
1. **環境準備:**
   - pnpmによるパッケージインストール
   - TypeScript設定の確認
   - lint/format設定の確認
   - Git hooks設定の確認

2. **計画実行:**
   - ツールを適切に使用して実装
   - 各ステップで信頼度スコアを提示
   - TypeScriptの型システムを最大限活用

3. **ドキュメント更新:**
   - 重要な変更をメモリーバンクに記録
   - 実装上の判断を文書化
   - API仕様の更新（日英併記）

4. **動作確認:**
   - 変更が期待通りに機能するか検証
   - 関連機能への影響を評価
   - 非推奨機能の使用がないか確認

5. **コミット管理:**
   - 変更内容を日本語で要約
   - conventional commitsに準拠
   - PRの準備（レビュー観点の明確化）

## 実装時の判断基準

### 既存コード保護
1. **変更前確認:**
   - 既存コードの状態を記録
   - 変更の必要性を明確化
   - 参考実装の有無を確認

2. **影響評価:**
   - 変更範囲を特定
   - 既存機能の維持を確認
   - 型定義への影響を確認

3. **段階的変更:**
   - 小さな変更から開始
   - 各変更後に動作確認
   - 型エラーの即時修正

### 修正制限
1. **同一アプローチ:**
   - 最大2回まで試行
   - 3回目で方針転換
   - 参考実装の再調査

2. **同一エラー:**
   - 最大2回まで対応
   - 3回目で根本的解決策を検討
   - 類似事例の調査

3. **複雑さ管理:**
   - 関数: 50行以内
   - ネスト: 最大3層
   - 依存関係: 1機能あたり最大3つ
   - 型定義の複雑さ制御

4. **タイムボックス:**
   - アプローチ試行: 最大30分
   - エラー解決: 最大15分
   - 調査時間: 実装前に最大2時間

### 中止判断基準
1. **複雑化の兆候:**
   - コード行数超過
   - ネスト深さ超過
   - 依存関係増加
   - 型定義の複雑化

2. **パフォーマンス問題:**
   - 実行時間2倍以上
   - メモリ使用量急増
   - レスポンス1秒超過
   - ビルド時間の顕著な増加

3. **エラー深刻度:**
   - 同一エラー3回以上
   - 原因不明
   - 他機能への影響
   - 型エラーの解決が困難