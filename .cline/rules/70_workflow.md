## ワークフローパターン

### タスク開始時の分析
1. **事前調査:**
   - 類似実装やベストプラクティスの調査
   - 参考リポジトリの構成確認
   - 使用技術の最新推奨事項の確認
   - 調査結果の文書化

2. **メモリーバンク確認:**
   - 関連するメモリーバンクファイルを精査
   - コンテキストを完全に把握

3. **要求分析:**
   - ユーザーの要求を明確化
   - 既存コードとの整合性を確認
   - 技術的制約の特定

4. **アプローチ検討:**
   - 複数の実装方法を列挙
   - 参考実装との比較検討
   - 評価基準に基づき最適な方法を選択
   - 選定理由の文書化

5. **AI協業計画:**
   - プロンプト戦略の立案
   - 必要なコンテキストの整理
   - フィードバックサイクルの設計
   - 評価基準の設定

6. **タスク分割:**
   - 最小実装単位への分割（30分以内で完了可能なサイズ）
   - 依存関係の明確化
   - 優先順位付け
   - 実装順序の決定

7. **計画立案:**
   - 必要な手順を明確化
   - 使用するツールを特定（pnpm優先）
   - TypeScriptでの実装計画
   - レビュー計画の作成

### 実装と検証
1. **環境準備:**
   - pnpmによるパッケージインストール
   - TypeScript設定の確認
   - lint/format設定の確認
   - Git hooks設定の確認

2. **計画実行:**
   - ツールを適切に使用して実装
   - 各ステップで信頼度スコアを提示
   - TypeScriptの型システムを最大限活用

3. **実装ログ記録:**
   ```markdown
   ### 実装ログ（実装日時: YYYY-MM-DD HH:mm）

   #### タスク概要
   - 実装項目: [機能名/修正内容]
   - 想定時間: XX分
   - 実際時間: XX分
   - 信頼度: [1-10]

   #### 実装詳細
   1. 変更内容
      - ファイル: path/to/file
      - 概要: 具体的な変更内容
      - 理由: 変更が必要な理由

   2. AI生成コード
      - 生成モデル: [モデル名]
      - プロンプト: [概要]
      - 修正箇所: [人間による修正点]
      - レビュー結果: [確認項目と結果]

   3. テスト結果
      - 単体テスト: [成功/失敗]
      - 結合テスト: [成功/失敗]
      - カバレッジ: XX%

   #### 課題・懸念事項
   - [ ] 要対応: [課題の詳細]
   - [ ] 要確認: [確認が必要な項目]

   #### 次のステップ
   1. [次の実装タスク]
   2. [必要な確認事項]
   ```

4. **動作確認:**
   - 変更が期待通りに機能するか検証
   - 関連機能への影響を評価
   - 非推奨機能の使用がないか確認

5. **コミット管理:**
   - 変更内容を日本語で要約
   - conventional commitsに準拠
   - PRの準備（レビュー観点の明確化）

### AI利用ガイドライン

#### セッション管理
- 1セッション1タスクの原則
- コンテキストの完全な記録
- 中断時の状態保存
- 再開時の状態復元手順

#### プロンプト設計
- 明確な目的と制約の提示
- 必要最小限のコンテキスト提供
- 段階的な指示（複雑なタスクは分割）
- 肯定的な表現の使用

#### レビュープロセス
- 生成コードの完全な理解
- 型安全性の確認
- エッジケースの考慮
- パフォーマンスとセキュリティの評価

## 実装時の判断基準

### 既存コード保護
1. **変更前確認:**
   - 既存コードの状態を記録
   - 変更の必要性を明確化
   - 参考実装の有無を確認

2. **影響評価:**
   - 変更範囲を特定
   - 既存機能の維持を確認
   - 型定義への影響を確認

3. **段階的変更:**
   - 小さな変更から開始
   - 各変更後に動作確認
   - 型エラーの即時修正

### 修正制限
1. **同一アプローチ:**
   - 最大2回まで試行
   - 3回目で方針転換
   - 参考実装の再調査

2. **同一エラー:**
   - 最大2回まで対応
   - 3回目で根本的解決策を検討
   - 類似事例の調査

3. **複雑さ管理:**
   - 関数: 50行以内
   - ネスト: 最大3層
   - 依存関係: 1機能あたり最大3つ
   - 型定義の複雑さ制御

4. **タイムボックス:**
   - アプローチ試行: 最大30分
   - エラー解決: 最大15分
   - 調査時間: 実装前に最大2時間

### 中止判断基準
1. **複雑化の兆候:**
   - コード行数超過
   - ネスト深さ超過
   - 依存関係増加
   - 型定義の複雑化

2. **パフォーマンス問題:**
   - 実行時間2倍以上
   - メモリ使用量急増
   - レスポンス1秒超過
   - ビルド時間の顕著な増加

3. **エラー深刻度:**
   - 同一エラー3回以上
   - 原因不明
   - 他機能への影響
   - 型エラーの解決が困難
