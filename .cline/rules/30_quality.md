### 8. コード品質管理

- **静的解析とフォーマット**
  - **リンター:** ESLint を使用。推奨設定: `eslint-config-airbnb-typescript` 等をベースにカスタマイズ。プラグイン (`import`, `jsx-a11y`, `react`, `react-hooks` 等) を活用。
  - **フォーマッター:** Prettier を使用。ESLint と連携 (`prettier-eslint`)。
  - 設定ファイル (`.eslintrc.js`, `.prettierrc.js` 等) はプロジェクトルートで共有。
  - TypeScript固有の設定を優先し、より厳格なルールを適用。
- **コードレビュー**
  - Pull Request ベースで実施。
  - レビュー観点: 可読性、設計原則遵守、パフォーマンス、セキュリティ、テスト網羅性。
  - プロセス: PR作成 → レビュアー指名 → レビューコメント → 修正 → 再レビュー → マージ。
- **コードの完全性**
   - "DO NOT BE LAZY. DO NOT OMIT CODE."
   - 常に完全なコードを提供すること。コードの切り捨てや省略は絶対に行わない。
   - `write_to_file` ツール使用時は、インポート文から末尾まで、**変更の有無に関わらず全ての行を**含めて完全なファイル内容を提供。
   - `[...]` や `[省略]` のような**いかなる形式の省略記号も使用しない**。
   - 既存機能の維持を確認。

---

#### 【AI生成物の品質評価基準・チェックリスト】

- AI生成物の品質評価は以下の観点で必ず実施し、チェックリストを用いること。
  - 型安全性（TypeScript型定義が正確か）
  - パフォーマンス（不要な計算や遅延がないか）
  - セキュリティ（脆弱性やリスクがないか）
  - 可読性・保守性（命名・コメント・構造が適切か）
  - エラー処理（例外や失敗時の挙動が明確か）
  - テスト容易性（テストコードが書きやすい設計か）

- チェックリスト例：
  - [ ] 型定義が正確でany等の乱用がない
  - [ ] エラー処理が網羅されている
  - [ ] セキュリティリスクがない
  - [ ] パフォーマンスに問題がない
  - [ ] 可読性・保守性が高い
  - [ ] テスト容易性が確保されている

- レビュー時はこのチェックリストを必ず記録・保存し、承認フローの一部とすること。

---

### 9. セキュリティ

- **依存関係管理:**
  - pnpmを使用し、定期的に `pnpm audit` を実行
  - Snyk等のツールと連携し、脆弱性を自動チェック
  - 更新計画を文書化し、定期的なメンテナンスを実施

- **環境変数管理:**
  - 機密情報はコードに含めず、環境変数で管理。
  - Doppler, AWS Secrets Manager 等のシークレット管理サービスの利用を推奨。
  - または `.env` ファイルを使用し、必ず `.gitignore` に追加。`.env.example` を用意。

- **自動実行の制限:**
  - `eval`、`new Function` の使用を禁止
  - シェルコマンドの実行は専用の安全な関数を介して行う
  - ユーザー入力を含むコマンドは実行前に必ずサニタイズ
  - 自動実行されるスクリプトは全て事前承認が必要

- **データベース操作の安全性:**
  - スキーマ変更は必ずマイグレーションファイルを作成
  - 本番DBへの直接アクセスは原則禁止
  - バックアップを取得してから変更を実施
  - ロールバック手順を事前に準備

- **コードインジェクション対策:**
  - パラメータ化クエリの使用を強制
  - 動的SQLの生成は専用のビルダーを使用
  - ユーザー入力は全てバリデーションを実施
  - 出力時のエスケープ処理を徹底

- **セッション管理:**
  - JWTの有効期限を適切に設定
  - リフレッシュトークンの再利用を防止
  - セッションIDの推測を困難に
  - CSRFトークンを必須化

- **TypeScript固有の対策:**
  - strict modeの有効化を必須とする
  - any型の使用を厳格に制限
  - 型アサーションは最小限に
  - unknown型を積極的に活用

- **その他:**
  - 入力値バリデーション、出力値エスケープ、セキュアなAPI設計を心がける。
  - TypeScriptの型システムを活用してセキュリティを強化。

- **許可コマンド:**
  - 基本: `pnpm`, `npm`（代替手段がない場合のみ）, `node`, `git` のみ
  - DB操作: マイグレーションコマンドのみ
  - デプロイ: CI/CD経由のみ
  - その他の破壊的操作は要確認

### 10. ドキュメントとコメント

- **コメント:** 日本語で、コードの意図や複雑なロジックを補足。自明なコードには不要。
- **APIドキュメント:** JSDoc形式で記述。型定義と合わせて参照可能に。日英併記を推奨。
- **README.md:** プロジェクト概要、セットアップ手順、実行方法などを記載し、最新状態を維持。
- **技術調査ドキュメント:** 選定理由、参考実装、検討内容を記録。
- **エンコーディング:** UTF-8 を使用。

### 11. バージョン管理 (Git)

- **ブランチ戦略:** GitHub Flow または Git Flow をベースとする。`main` ブランチは常にデプロイ可能状態を維持。
- **コミット規約:**
  - **メッセージ形式:** Conventional Commits 形式を推奨。
    - `<type>(<scope>): <subject>`
    - `type`: feat, fix, docs, style, refactor, test, chore など。
    - `scope`: 変更範囲 (任意)。
    - `subject`: 簡潔な日本語説明文（体言止め）。
    - 例: `feat(auth): ログイン機能を追加`
  - **記述言語:** 日本語を使用。技術用語のみ英語可。
  - **粒度:** 1つの論理的な変更を1コミットに。レビュー可能なサイズ (目安: 200行以内)。
  - **タイミング:** 機能実装完了時、バグ修正完了時など、キリの良いタイミングでコミット。WIPコミットは避ける。
  - **必須事項:** 作業完了時は必ずコミット。未コミット変更を残さない。PRレビュー必須。
- **作業前確認:**
  - 作業ブランチの最新化
  - 作業内容の明確化
  - 影響範囲の確認
  - 参考実装の有無の確認

### 12. AI連携

- **プロンプト:**
  - 明確かつ具体的に指示
  - 必要なコンテキスト (コードスニペット、エラーメッセージ等) を提供
  - 日本語で記述
- **生成コードのレビュー:**
  - AIが生成したコードも人間が書いたコードと同様にレビュー対象とする。
  - 特に、ロジックの正確性、エッジケース考慮、セキュリティ、パフォーマンス、既存コードとの整合性を重点的に確認。
  - 安易に受け入れず、必ず理解・検証してからマージする。
  - 生成コードの採用理由を文書化。

### 13. ルール強制

- **pre-commitフック:**
  - pnpmとhuskyを使用
  - lint-stagedでコミット時の自動チェックを実行
  - 最新の推奨設定方法を定期的に確認
- **CI (継続的インテグレーション):**
  - GitHub Actions等を利用
  - Pull Request時にlint, test, build, vulnerability checkを自動実行
  - 非推奨機能の使用検知
  - ルール違反があればマージをブロック